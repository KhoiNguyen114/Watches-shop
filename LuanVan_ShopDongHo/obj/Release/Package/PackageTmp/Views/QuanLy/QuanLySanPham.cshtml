@using LuanVan_ShopDongHo.Models;
@using PagedList.Mvc;
@{
    ViewBag.Title = "QuanLySanPham";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@model SANPHAM
<h2 style="color: brown; font-weight: 800">Quản lý sản phẩm</h2>
<br />

<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 row">
            <div class="col-md-3">
                <span class="form-group">
                    <label>Hãng</label>
                    @Html.DropDownListFor(model => model.MAHANG, new SelectList(ViewBag.dsHang, "MAHANG", "TENHANG", ViewBag.maHang), new { @class = "form-control", @id = "maHang", @style = "border-radius: 10px;" })
                </span>
            </div>
            <div class="col-md-3">
                <span class="form-group">
                    <label>Mã bảo hành</label>
                    @Html.DropDownListFor(model => model.MABAOHANH, new SelectList(ViewBag.dsBaoHanh, "MANOIDUNG", "MANOIDUNG", ViewBag.maBH), new { @class = "form-control", @id = "maBH", @style = "border-radius: 10px;" })
                </span>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Thời gian bảo hành</label>
                    @Html.DropDownListFor(model => model.ThoiHanBH, new SelectList(ViewBag.dsThoiHanBaoHanh, "Value", "Text", ViewBag.thoigianBH), new { @class = "form-control", @id = "thoigianBH", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Mã danh mục</label>
                    @Html.DropDownListFor(model => model.MADM, new SelectList(ViewBag.dsDMSP, "MADM", "TENDM", ViewBag.maDM), new { @class = "form-control", @id = "maDM", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Phiên bản sản phẩm</label>
                    @Html.DropDownListFor(model => model.DONGSP, new SelectList(ViewBag.dsPhienBan, "Value", "Text", ViewBag.pb), new { @class = "form-control", @id = "pb", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Năng lượng</label>
                    @Html.DropDownListFor(model => model.NANGLUONG, new SelectList(ViewBag.dsNangLuong, "Value", "Text", ViewBag.nl), new { @class = "form-control", @id = "nl", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Loại dây</label>
                    @Html.DropDownListFor(model => model.LOAIDAY, new SelectList(ViewBag.dsLoaiDay, "Value", "Text", ViewBag.ld), new { @class = "form-control", @id = "ld", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label>Xuất sứ</label>
                    @Html.DropDownListFor(model => model.XUATSU, new SelectList(ViewBag.dsQuocGia, "Value", "Text", ViewBag.xs), new { @class = "form-control", @id = "xs", @style = "border-radius: 10px;" })
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label>Trạng thái</label>
                    @Html.DropDownListFor(model => model.TRANGTHAI, new SelectList(ViewBag.dsTT, "Value", "Text", ViewBag.trangThai), new { @class = "form-control", @id = "trangThai", @style = "border-radius: 10px;" })
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <button class="btn btn-XanhLuc mt-4" style="text-transform: uppercase; font-weight: bold;" id="btnSearch">
                <i class="fas fa-search"></i>
                Tìm kiếm
            </button>
        </div>
    </div>

    <div class="mt-3 row">
        <table class="table table-bordered table-hover">
            <tr class="tr-Title" style="text-align: center; font-size: 18px">
                <th>STT</th>
                <th>Mã sản phẩm</th>
                <th>Tên sản phẩm</th>
                <th>Đơn giá (VNĐ)</th>
                <th>Hình ảnh</th>
                <th>Chi tiết sản phẩm</th>
                <th>Số lượng</th>
                <th>Mã hãng</th>
                <th>Mã bảo hành</th>
                <th>Thời hạn bảo hành</th>
                <th>Mã danh mục</th>
                <th>Dòng sản phẩm</th>
                <th>Năng lượng</th>
                <th>Kích thước</th>
                <th>Loại dây</th>
                <th>Xuất sứ</th>
                <th>Thao tác</th>
            </tr>
            @{
                int dem = 0;
                int pageNum = ViewBag.pageNum;
                int pageSize = ViewBag.pageSize;
                dem = (pageNum - 1) * pageSize;
            }
            @foreach (var sp in ViewBag.dsSPLoad)
            {
                dem++;
                <tr>
                    <td>@dem</td>
                    <td>@sp.MASP</td>
                    <td>@sp.TENSP</td>
                    <td>@string.Format("{0: #,##}", sp.DONGIA)</td>
                    <td>
                        <img src="~/Content/Images/SanPham/@sp.HINHANH" width="50" height="50" />
                    </td>
                    <td>@sp.CHITIETSP</td>
                    <td>@sp.SOLUONG</td>
                    <td>@sp.MAHANG</td>
                    <td>@sp.MABAOHANH</td>
                    <td>@sp.ThoiHanBH</td>
                    <td>@sp.MADM</td>
                    <td>@sp.DONGSP</td>
                    <td>@sp.NANGLUONG</td>
                    <td>@sp.KICHTHUOC</td>
                    <td>@sp.LOAIDAY</td>
                    <td>@sp.XUATSU</td>
                    <td>
                        @if (sp.TRANGTHAI == false)
                        {
                            <button class="btn btn-success" onclick="GetSanPham(this)" id="@sp.MASP"><i class="fas fa-edit mr-2"></i></button><br /><br />
                            <button class="btn btn-danger" id="@sp.MASP" onclick="GetIDSanPhamQLSPDelete(this)" data-bs-toggle="modal" data-bs-target="#myModalDeleteSanPham"><i class="fas fa-trash mr-2"></i></button>
                        }
                        else
                        {
                            <button class="btn btn-primary" id="@sp.MASP" onclick="KhoiPhucSanPham(this)"><i class="fas fa-trash-restore"></i></button>
                        }
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

<div class="spacer20">
    <center>
        <div class="pagination">
            @Html.PagedListPager((PagedList.IPagedList)ViewBag.dsSPLoad, page => Url.Action("QuanLySanPham", new { page, @class = "active", maHang = ViewBag.maHang, maBH = ViewBag.maBH, thoigianBH = ViewBag.thoigianBH, maDM = ViewBag.maDM, pb = ViewBag.pb, nl = ViewBag.nl, ld = ViewBag.ld,xs = ViewBag.xs }))
        </div>
    </center>
</div>


<!-- Modal cập nhật sản phẩm-->
<div class="modal fade" id="myModalEdit" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel" style="font-weight: bold; text-transform: uppercase">Cập nhật sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Mã sản phẩm</label>
                    <input type="text" id="maSPSua" class="form-control" disabled="disabled" />
                    <span id="maSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Tên sản phẩm</label>
                    <input type="text" id="tenSPSua" class="form-control" />
                    <span id="tenSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Chi tiết sản phẩm</label>
                    <input type="text" id="chiTietSPSua" class="form-control" />
                    <span id="chiTietSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Đơn giá</label>
                    <input type="number" id="donGiaSPSua" class="form-control" />
                    <span id="donGiaSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Hình ảnh</label>
                    <input type="file" id="hinhAnhSPSua" onchange="LoadAnhFolderSuaSP(this)" /><br /><br />
                    <img src="" width="200" height="150" id="Image_SPSua" />
                    <span id="hinhAnhSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Số lượng</label>
                    <input type="number" id="soLuongSPSua" class="form-control" />
                    <span id="soLuongSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Mã hãng</label>
                    @Html.DropDownListFor(model => model.MAHANG, new SelectList(ViewBag.dsHang, "MAHANG", "TENHANG"), new { @class = "form-control", @id = "maHangSPSua" })
                    <span id="HangSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Mã bảo hành</label>
                    @Html.DropDownListFor(model => model.MABAOHANH, new SelectList(ViewBag.dsBaoHanh, "MANOIDUNG", "MANOIDUNG"), new { @class = "form-control", @id = "maNoiDungSPSua" })
                    <span id="BaoHanhSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Thời gian bảo hành (năm)</label>
                    @Html.DropDownListFor(model => model.ThoiHanBH, new SelectList(ViewBag.dsThoiHanBaoHanh, "Value", "Text"), new { @class = "form-control", @id = "ThoiGianBHSPSua" })
                    <span id="ThoiGianBHSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Mã danh mục</label>
                    @Html.DropDownListFor(model => model.MADM, new SelectList(ViewBag.dsDMSP, "MADM", "TENDM"), new { @class = "form-control", @id = "maDanhMucSPSua" })
                    <span id="DanhMucSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Phiên bản sản phẩm</label>
                    @Html.DropDownListFor(model => model.DONGSP, new SelectList(ViewBag.dsPhienBan, "Value", "Text"), new { @class = "form-control", @id = "phienBanSPSua" })
                    <span id="phienBanSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Kích thước</label>
                    <input type="number" id="kichThuocSPSua" class="form-control" />
                    <span id="kichThuocSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Năng lượng</label>
                    @Html.DropDownListFor(model => model.NANGLUONG, new SelectList(ViewBag.dsNangLuong, "Value", "Text"), new { @class = "form-control", @id = "nangLuongSPSua" })
                    <span id="nangLuongSPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Loại dây</label>
                    @Html.DropDownListFor(model => model.LOAIDAY, new SelectList(ViewBag.dsLoaiDay, "Value", "Text"), new { @class = "form-control", @id = "loaiDaySPSua" })
                    <span id="loaiDaySPSuaVL" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>Xuất sứ</label>
                    @Html.DropDownListFor(model => model.XUATSU, new SelectList(ViewBag.dsQuocGia, "Value", "Text"), new { @class = "form-control", @id = "xuatSuSPSua" })
                </div>
                <div class="form-group">
                    <label>Mô tả sản phẩm</label>
                    <textarea id="txtMoTaSPSua"></textarea>
                    <span id="txtMoTaSPSuaVL" class="text-danger"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-XanhLuc" id="btnCapNhat">Cập nhật</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<!--End modal cập nhật sản phẩm-->
<!-- Modal xóa sản phẩm-->
<div class="modal fade" id="myModalDeleteSanPham" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel" style="font-weight: bold; text-transform: uppercase">Xóa sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" hidden="hidden" id="idSanPhamQLSPDelete" value="" />
                    <p>Bạn có chắc chắn muốn xóa sản phẩm này không</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-Do" id="btnXoaSanPhamQLSP">Xóa</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<!--End modal xóa sản phẩm-->
<script type="text/javascript">
    $('#btnSearch').click(function (e) {
        e.preventDefault();
        var url = window.location.origin + "/QuanLy/QuanLySanPham?&maHang=" + $('#maHang').val() + "&maBH=" + $('#maBH').val() + "&thoigianBH=" + $('#thoigianBH').val() + "&maDM=" + $('#maDM').val() + "&pb=" + $('#pb').val() + "&nl=" + $('#nl').val() + "&ld=" + $('#ld').val() + "&xs=" + $('#xs').val() + "&trangThai=" + $('#trangThai').val();
        window.location = url;
    })
</script>